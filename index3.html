<!DOCTYPE html>
<html lang="en">

<head>
  <title>Basic Mappa Tutorial</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/p5.min.js" type="text/javascript"></script>
  <script src="https://unpkg.com/mappa-mundi@0.0.4/dist/mappa.min.js" type="text/javascript"></script>
</head>

<body>
  <script>
    // Create a variable to hold our map
    let myMap;
    // Create a variable to hold our canvas
    let canvas;
    // Create a new Mappa instance using Leaflet.
    const mappa = new Mappa('Leaflet');

    // Lets put all our map options in a single object
    const options = {
        lat: 61.3,
        lng: 23.4,
        zoom: 5,
        style: "http://{s}.tile.osm.org/{z}/{x}/{y}.png"
    }

    // p5.js setup
    function setup(){
        // Create a canvas 640x640
        canvas = createCanvas(1200,640); 
        // Add a grey background
        // background(100);

        // Create a tile map with lat 0, lng 0, zoom 4
        myMap = mappa.tileMap(options);
        // Overlay the canvas over the tile map
        myMap.overlay(canvas);

        fill(200, 100, 100);

        // Only redraw the point when the map changes
        myMap.onChange(drawPoint);

        angleMode(DEGREES);
    }



    let angle = 0;


  function draw() {

    clear();

    // background(255);
        // Every Frame, get the canvas position 
        // for the latitude and longitude of Nigeria
        const vienna = myMap.latLngToPixel(48.21, 16.37); 
        // Using that position, draw an ellipse
        // ellipse(vienna.x, vienna.y, 20, 20);
        const helsinki = myMap.latLngToPixel(60.170, 24.938);
        const stockholm = myMap.latLngToPixel(59.329, 18.069);
        const oslo = myMap.latLngToPixel(59.914, 10.752);

        pinWheel(helsinki, angle);
        pinWheel(stockholm, angle);
        pinWheel(oslo, angle);
        myMap.onChange(drawPoint);
        angle+=.5

}


    function drawPoint(){
        // clear();

    }

    function pinWheel(city, angle){
        push();
        // console.log(`city: ${city.x, city.y}`)
        translate(city.x, city.y - 75);
        // translate(100, 100);
        scale(.5);
        //line
        strokeWeight(6);
        stroke(250, 20, 40);
        strokeWeight(4);
        line(0, 0, 0, 150);

        rotate(angle);
        stroke(0);

        //shape
        for (let i=0; i<5; i++) {
            //pink shape 1
            fill(250, 128, 114); // salmon
            // rect(10, 10, 100, 50);
            beginShape();
                curveVertex(0, 0);    // first control point
                curveVertex(0, 0);    // anchor 1
                curveVertex(20, 5);   // anchor 2
                curveVertex(20, 5);   // second control point
                curveVertex(23, 22);  // anchor 1
                curveVertex(40, 45);  // anchor 2
                curveVertex(50, 50);  // third control point
                curveVertex(40, 50);  // anchor 1
                curveVertex(15, 45);  // anchor 2
                curveVertex(-10, 40); // fourth control point
                curveVertex(-15, 30); // anchor 1
                curveVertex(-10, 15); // anchor 2
                curveVertex(0, 0);    // fifth control point
                curveVertex(0, 0);    // anchor 1
            endShape();

            //white shape 1
            fill(250);
            beginShape();
                curveVertex(20, 5);   // second control point
                curveVertex(23, 22);  // anchor 1
                curveVertex(40, 45);  // anchor 2
                curveVertex(50, 50);  // third control point
                curveVertex(100, 35);
                curveVertex(100, 29);
                curveVertex(20, 5);
                curveVertex(20, 5);
            endShape();
            rotate(360/4); 
        }
        pop();
    }

    // Define the API URL
    const apiUrl = 'https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41&hourly=wind_speed_10m';

    // Make a GET request
    fetch(apiUrl)
    .then(response => {
        if (!response.ok) {
        throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log(data);
    })
    .catch(error => {
        console.error('Error:', error);
    });

    </script>
</body>

</html>